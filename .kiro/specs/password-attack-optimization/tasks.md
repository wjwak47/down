# 密码破解攻击顺序优化实施计划

## 概述

基于密码学专家分析，重新实现7层密码破解逻辑的执行顺序，以实现最优的ROI（投资回报率）和用户体验。

## 任务

- [x] 1. 更新攻击阶段定义和常量
  - 重新定义 `GPU_ATTACK_PHASES` 常量，按照新的优化顺序
  - 更新阶段描述、预估时间和成功率数据
  - 添加ROI计算相关的元数据
  - _需求: 1.1, 1.2, 1.3_

- [x] 2. 实现合并快速攻击（FastCombo）
  - [x] 2.1 创建 `runFastComboAttack` 函数
    - 合并Top10K和键盘模式攻击
    - 实现并行执行逻辑，使用Promise.race优化
    - 添加进度反馈和统计收集
    - _需求: 1.1, 5.1_

  - [ ]* 2.2 编写FastCombo攻击的单元测试
    - 测试并行执行的正确性
    - 测试进度反馈机制
    - 测试错误处理和超时机制
    - _需求: 1.1_

- [x] 3. 优化AI密码生成阶段
  - [x] 3.1 调整AI生成策略
    - 优化PassGPT生成参数，提高命中率
    - 减少生成时间，控制在2-3分钟内
    - 改进批次大小和生成逻辑
    - _需求: 1.1, 3.1_

  - [ ]* 3.2 编写AI优化的性能测试
    - 测试生成速度和质量
    - 验证时间控制机制
    - 测试不同参数配置的效果
    - _需求: 1.1_

- [x] 4. 限制短密码暴力破解范围
  - [x] 4.1 实现智能分层短密码破解策略
    - ✅ 创建 `SHORT_PASSWORD_STRATEGY` 常量定义3层策略
    - ✅ 实现 `runSmartLayeredBruteforce` 函数支持1-3/4-6/7-8位分层
    - ✅ 创建 `OPTIMIZED_MASK_STRATEGY` 基于Hashcat性能研究
    - ✅ 实现字符集性能排序（数字→字母→混合→全字符）
    - ✅ 添加动态掩码生成和GPU优化
    - _需求: 1.3, 3.1_

  - [x] 4.2 保持向后兼容性
    - ✅ 保留 `runShortBruteforceOptimized` 函数作为兼容接口
    - ✅ 重定向到新的智能分层破解（仅执行第一层）
    - ✅ 更新主破解流程使用新的分层策略
    - _需求: 1.3_

  - [x] 4.3 实现攻击模式支持
    - ✅ 快速模式：仅1-3位（5-15秒，15%成功率）
    - ✅ 标准模式：1-6位（1-5分钟，40%成功率）
    - ✅ 深度模式：1-8位（10-30分钟，60%成功率）
    - ✅ 添加时间预算和动态层级选择
    - _需求: 3.1, 3.2, 3.3_

  - [x] 4.4 编写短密码优化测试
    - ✅ 创建 `test-short-password-optimization.js` 验证测试
    - ✅ 测试3层策略定义和ROI分析
    - ✅ 测试攻击模式层级选择逻辑
    - ✅ 测试掩码优化策略和性能排序
    - ✅ 验证预期效果和实施正确性（6/6测试通过）
    - _需求: 1.3_

- [x] 5. 重新排序字典和规则攻击
  - [x] 5.1 调整字典攻击优先级
    - 将完整字典攻击移至第4位
    - 优化字典大小，从14M减少到5M最常用密码
    - 更新进度反馈和时间估算
    - _需求: 1.1, 1.2_

  - [x] 5.2 优化规则变换攻击
    - 精简规则集，移除低效规则
    - 调整执行顺序至第5位
    - 优化执行时间控制
    - _需求: 1.1, 1.2_

  - [ ]* 5.3 编写字典和规则攻击测试
    - 测试新的执行顺序
    - 验证字典大小优化效果
    - 测试规则集精简的影响
    - _需求: 1.1, 1.2_

- [x] 6. 实现攻击调度器
  - [x] 6.1 创建 `AttackScheduler` 类
    - 实现快速、标准、深度三种模式
    - 添加时间预算控制机制
    - 实现动态阶段选择逻辑
    - _需求: 3.1, 3.2, 3.3_

  - [x] 6.2 集成调度器到主破解流程
    - 修改 `crackWithHashcat` 函数使用新调度器
    - 更新进度反馈显示模式信息
    - 添加用户模式选择接口
    - _需求: 3.1, 3.2, 3.3_

  - [ ]* 6.3 编写调度器测试
    - 测试三种模式的阶段选择
    - 验证时间预算控制
    - 测试动态调整机制
    - _需求: 3.1, 3.2, 3.3_

- [ ] 7. 实现ROI计算和统计收集
  - [ ] 7.1 创建 `ROICalculator` 类
    - 实现ROI计算公式
    - 添加历史数据分析功能
    - 实现动态优先级调整
    - _需求: 4.1, 4.2, 4.3_

  - [ ] 7.2 创建 `AttackStatistics` 类
    - 实现攻击结果统计收集
    - 添加成功率和时间数据存储
    - 实现统计数据持久化
    - _需求: 4.1, 4.2, 4.3, 4.4_

  - [ ]* 7.3 编写统计和ROI计算测试
    - 测试ROI计算的准确性
    - 验证统计数据收集机制
    - 测试动态调整算法
    - _需求: 4.1, 4.2, 4.3_

- [x] 8. 更新主破解流程
  - [x] 8.1 重构 `crackWithHashcat` 函数
    - 按照新的阶段顺序重新组织代码
    - 更新阶段编号和进度反馈
    - 集成新的攻击函数和调度器
    - _需求: 1.1, 1.2, 1.3_

  - [x] 8.2 更新进度显示和用户反馈
    - 修改进度消息显示新的阶段名称
    - 更新时间估算和成功率显示
    - 添加模式选择的用户界面提示
    - _需求: 1.1, 3.1_

  - [ ]* 8.3 编写主流程集成测试
    - 测试完整的破解流程
    - 验证新顺序的执行正确性
    - 测试进度反馈的准确性
    - _需求: 1.1, 1.2, 1.3_

- [ ] 9. 实现并行化支持
  - [ ] 9.1 添加资源检测机制
    - 检测GPU和CPU资源可用性
    - 实现资源冲突检测
    - 添加动态并行度调整
    - _需求: 5.1, 5.2, 5.3, 5.4_

  - [ ] 9.2 实现兼容攻击的并行执行
    - 识别可并行执行的攻击组合
    - 实现CPU和GPU任务分配
    - 添加并行执行的协调机制
    - _需求: 5.1, 5.2_

  - [ ]* 9.3 编写并行化测试
    - 测试资源检测的准确性
    - 验证并行执行的效率
    - 测试资源冲突处理
    - _需求: 5.1, 5.2, 5.3_

- [ ] 10. 性能测试和基准对比
  - [ ] 10.1 建立性能基准测试
    - 创建标准测试用例集
    - 记录优化前的性能数据
    - 建立自动化测试流程
    - _需求: 所有需求_

  - [ ] 10.2 执行优化后性能测试
    - 测试新顺序的实际性能
    - 收集成功率和时间数据
    - 对比优化前后的改进效果
    - _需求: 所有需求_

  - [ ]* 10.3 编写性能回归测试
    - 建立持续性能监控
    - 添加性能回归检测
    - 创建性能报告生成机制
    - _需求: 所有需求_

- [ ] 11. 文档更新和用户指南
  - [ ] 11.1 更新技术文档
    - 更新代码注释和函数文档
    - 修改架构说明和流程图
    - 更新配置参数说明
    - _需求: 所有需求_

  - [ ] 11.2 创建用户使用指南
    - 编写模式选择指南
    - 创建性能优化建议
    - 添加故障排除说明
    - _需求: 3.1, 3.2, 3.3_

- [ ] 12. 最终验证和发布准备
  - [ ] 12.1 执行全面集成测试
    - 测试所有功能的集成效果
    - 验证向后兼容性
    - 测试错误处理和边界情况
    - _需求: 所有需求_

  - [ ] 12.2 准备发布版本
    - 更新版本号到v1.2.2
    - 创建发布说明文档
    - 准备用户升级指南
    - _需求: 所有需求_

## 检查点

- [x] 检查点1: 核心重构完成
  - 确保新的攻击顺序正确实现
  - 验证FastCombo攻击正常工作
  - 测试AI优化效果

- [ ] 检查点2: 调度器和统计系统完成
  - 确保三种模式正确工作
  - 验证ROI计算和统计收集
  - 测试动态调整机制

- [ ] 检查点3: 性能优化验证
  - 确认性能提升达到预期目标
  - 验证用户体验改进
  - 完成所有测试用例

## 注意事项

- 任务标记 `*` 的为可选测试任务，可根据时间安排决定是否执行
- 每个检查点都需要确保所有测试通过才能继续
- 保持向后兼容性，确保现有用户不受影响
- 重点关注前5分钟的成功率提升，这是用户体验的关键指标

## 当前进度总结

✅ **已完成核心重构和短密码优化 (检查点1+)**:
- 新的ROI优化攻击顺序已实现
- FastCombo攻击函数已创建，支持Top10K和键盘模式并行执行
- AI生成阶段已优化
- **🆕 智能分层短密码破解已实现**：
  - 3层策略：1-3位(超短)、4-6位(短)、7-8位(中短)
  - 基于Hashcat性能研究的掩码优化
  - 字符集性能排序（数字→字母→混合→全字符）
  - 支持fast/standard/deep三种模式的动态层级选择
  - 向后兼容现有接口
- 智能字典攻击已实现（5M优化）
- 攻击调度器已集成到主破解流程
- 主破解函数已重构，支持fast/standard/deep三种模式
- **🆕 短密码优化测试验证**：6/6测试通过，预期效果显著

🔄 **下一步**: 继续实现ROI计算和统计收集系统 (任务7)

📊 **短密码优化效果预期**:
- 快速模式(5分钟): 10% → 40% (+300%)
- 标准模式(30分钟): 25% → 65% (+160%) 
- 深度模式(无限制): 30% → 85% (+183%)