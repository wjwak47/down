# 实现计划 - 密码破解模块完整升级

## 概述

本实现计划将密码破解模块从"玩具级"升级到"行业领先"水平，分为三个阶段：
- **阶段1（P0）**：核心性能优化 - 1-2天
- **阶段2（P1）**：高级功能增强 - 1-2周  
- **阶段3（P2）**：AI智能增强 - 2-4周

总预期提升：500倍速度，45-50%命中率

---

## 任务清单

### 🔴 阶段1：P0核心优化（必做，1-2天）

- [x] 1. 实现批量测试功能
  - [x] 1.1 创建BatchTestManager类
    - 实现密码队列管理
    - 实现批量测试逻辑（batchSize=100）
    - 实现7-Zip批量调用（使用stdin管道）
    - 解析7-Zip输出，识别成功密码
    - _需求：1.1, 1.2, 1.3_
  
  - [x] 1.2 修改index.js集成批量测试
    - 替换原有的单个密码测试逻辑
    - 添加批量测试调用
    - 处理批量测试结果
    - _需求：1.1, 1.2_
  
  - [ ]* 1.3 编写批量测试单元测试
    - 测试密码队列管理
    - 测试批量测试正确性
    - 测试性能提升（目标：100倍）
    - **属性1：批量测试一致性**
    - **属性2：批量测试速度提升**
    - **验证需求：1.1, 1.2, 1.3, 1.4**

- [x] 2. 优化GPU攻击顺序
  - [x] 2.1 调整index.js的Phase顺序
    - 修改Phase定义顺序：字典 → 键盘 → 规则 → 掩码 → 混合 → 暴力破解 → CPU
    - 将键盘模式从Phase 5移到Phase 2
    - 更新所有Phase函数的currentPhase编号
    - 更新GPU_ATTACK_PHASES常量定义
    - _需求：2.1, 2.2_
  
  - [ ]* 2.2 编写Phase顺序测试
    - 测试常见密码提前命中
    - 测试60%密码在前3个Phase完成
    - **属性3：Phase顺序优化效果**
    - **验证需求：2.1, 2.2, 2.3, 2.4**

- [x] 3. 精简规则变换
  - [x] 3.1 分析并精简规则库
    - 统计当前200+规则的命中率
    - 删除命中率<1%的规则
    - 保留约50个高频规则
    - 更新RULE_TRANSFORMATIONS数组
    - _需求：3.1, 3.2, 3.3, 3.4_
  
  - [ ]* 3.2 编写规则精简测试
    - 测试精简后命中率不降低
    - 测试无效尝试减少75%
    - **属性4：规则精简不降低命中率**
    - **验证需求：3.1, 3.2, 3.3**

- [x] 4. 阶段1检查点
  - 运行所有测试，确保通过
  - 性能测试：验证速度达到1000 pwd/s
  - 如有问题，询问用户

---

### 🟠 阶段2：P1高级优化（强烈建议，1-2周）

- [ ] 5. 实现PCFG规则生成
  - [ ] 5.1 创建PCFGGenerator类
    - 实现语法结构定义（L、D、S组合）
    - 实现密码结构概率分布
    - 实现密码片段库
    - 实现密码生成算法
    - _需求：4.1, 4.2_
  
  - [ ] 5.2 训练PCFG语法模型
    - 下载RockYou数据集
    - 分析密码结构分布
    - 生成pcfg_grammar.json
    - 打包到resources/data/
    - _需求：4.4_
  
  - [ ]* 5.3 编写PCFG生成器测试
    - 测试生成密码符合语法结构
    - 测试命中率提升3倍
    - **属性7：PCFG生成密码有效性**
    - **验证需求：4.1, 4.2, 4.3**

- [ ] 6. 优化Markov链生成
  - [ ] 6.1 重构Markov生成算法
    - 将数组队列改为栈
    - 实现生成器模式（function*）
    - 消除O(n)的shift操作
    - 优化内存使用
    - _需求：5.1, 5.2, 5.4_
  
  - [ ]* 6.2 编写Markov优化测试
    - 测试生成速度提升50倍
    - 测试内存占用<100MB
    - **属性8：Markov优化性能提升**
    - **验证需求：5.1, 5.2, 5.3, 5.4**

- [ ] 7. 实现自适应策略选择
  - [ ] 7.1 创建StrategySelector类
    - 定义策略类型（PERSONAL、WORK、GENERIC）
    - 实现文件特征识别
    - 实现策略选择逻辑
    - 实现Phase权重动态调整
    - _需求：6.1, 6.2, 6.3, 6.5_
  
  - [ ] 7.2 集成策略选择器到index.js
    - 在破解开始前调用策略选择
    - 根据策略调整Phase配置
    - _需求：6.3_
  
  - [ ]* 7.3 编写策略选择测试
    - 测试文件特征识别准确性
    - 测试策略选择正确性
    - 测试时间节省40%
    - **属性9：自适应策略正确性**
    - **验证需求：6.1, 6.2, 6.3, 6.4, 6.5**

- [-] 8. 实现断点续传功能
  - [x] 8.1 创建SessionManager类
    - 实现Session创建和保存
    - 实现Session加载和恢复
    - 实现Session状态持久化（JSON文件）
    - 实现未完成Session检测
    - _需求：7.1, 7.2, 7.3, 7.4_
  
  - [-] 8.2 修改index.js支持Session
    - 在破解开始时创建Session
    - 定期保存Session状态
    - 支持从Session恢复
    - _需求：7.1, 7.2_
  
  - [ ] 8.3 添加UI控制按钮
    - 添加"暂停"按钮
    - 添加"继续"按钮
    - 显示Session恢复提示
    - 修改FileCompressor.jsx
    - _需求：7.1, 7.2, 7.4_
  
  - [ ]* 8.4 编写Session管理测试
    - 测试Session保存和恢复
    - 测试不重复测试密码
    - 测试应用重启后恢复
    - **属性5：Session恢复幂等性**
    - **属性6：Session持久化完整性**
    - **验证需求：7.1, 7.2, 7.3, 7.4, 7.5**

- [-] 9. 实现实时统计和可视化
  - [x] 9.1 创建StatsCollector类
    - 收集速度、进度、预估时间等统计信息
    - 实现统计信息计算逻辑
    - _需求：12.1, 12.2, 12.3, 12.4_
  
  - [x] 9.2 更新UI显示统计信息
    - 显示当前速度（pwd/s）
    - 显示进度百分比
    - 显示当前Phase
    - 显示预计完成时间
    - 修改FileCompressor.jsx
    - _需求：12.1, 12.2, 12.3, 12.4, 12.5_
  
  - [ ]* 9.3 编写统计信息测试
    - 测试统计信息准确性（误差<5%）
    - **属性15：统计信息准确性**
    - **验证需求：12.1, 12.2, 12.3, 12.4**

- [ ] 10. 阶段2检查点
  - 运行所有测试，确保通过
  - 性能测试：验证速度达到2000 pwd/s
  - 功能测试：验证断点续传、自适应策略
  - 如有问题，询问用户

---

### 🟡 阶段3：P2 AI增强（2-4周）

#### 第一阶段：PassGPT集成（1周）

- [ ] 11. 准备PassGPT模型
  - [ ] 11.1 下载PassGPT预训练模型
    - 从Hugging Face下载PassGPT项目（javirandor/passgpt-10characters）
    - 获取预训练的PyTorch模型
    - _需求：8.1_
  
  - [ ] 11.2 转换模型为ONNX格式
    - 安装PyTorch和onnx库
    - 编写转换脚本（convert_passgpt.py）
    - 转换模型并验证输出
    - 优化模型大小（量化）
    - 导出词汇表（vocab.json）
    - _需求：8.1, 8.5_
  
  - [ ] 11.3 打包模型到应用
    - 将passgpt.onnx放到resources/models/
    - 将passgpt_vocab.json放到resources/models/
    - 更新package.json包含模型文件
    - 验证模型文件完整性（checksum）
    - _需求：8.5_

- [ ] 12. 实现PassGPT生成器
  - [ ] 12.1 安装onnxruntime-node依赖
    - 添加onnxruntime-node到package.json
    - 测试不同平台兼容性
    - _需求：8.1_
  
  - [ ] 12.2 创建PassGPTGenerator类
    - 实现模型加载逻辑（加载ONNX模型和词汇表）
    - 实现密码生成逻辑（批量推理，支持temperature采样）
    - 实现token解码和密码过滤
    - 实现资源释放
    - _需求：8.1, 8.2, 8.4_
  
  - [ ]* 12.3 编写PassGPT生成器测试
    - 测试模型加载成功
    - 测试生成密码有效性
    - 测试生成速度≥50,000 pwd/s
    - 测试命中率达到55-60%（比PassGAN高2倍）
    - **属性10：PassGPT模型输出有效性**
    - **验证需求：8.1, 8.2, 8.3, 8.4**

- [ ] 13. 集成PassGPT到破解流程
  - [x] 13.1 修改smartCracker.js添加AI Phase
    - 添加'ai' Phase定义
    - 设置最高优先级（priority=0）
    - 配置生成50,000个密码
    - _需求：8.2_
  
  - [x] 13.2 修改index.js调用PassGPT
    - 在Phase循环中添加AI Phase处理
    - 调用PassGPTGenerator生成密码
    - 批量测试AI生成的密码
    - _需求：8.2_
  
  - [x] 13.3 添加错误降级处理
    - AI模型加载失败时降级到传统方法
    - 记录错误日志
    - **属性16：错误降级安全性**
    - _需求：错误处理_

- [ ] 14. PassGPT阶段检查点
  - 测试PassGPT模型加载和推理
  - 测试命中率达到55-60%（比PassGAN高2倍）
  - 测试速度达到3000 pwd/s
  - 如有问题，询问用户

#### 第二阶段：本地LSTM学习（3-5天）

- [-] 15. 实现本地密码数据库
  - [x] 15.1 创建PasswordDB类
    - 初始化SQLite数据库
    - 创建password_history表
    - 实现密码添加（加密存储）
    - 实现密码查询
    - _需求：9.1, 9.5_
  
  - [ ]* 15.2 编写密码数据库测试
    - 测试密码加密存储
    - 测试不存储明文密码
    - **属性12：密码存储加密性**
    - **验证需求：9.1, 9.5, 13.1**

- [ ] 16. 实现LSTM学习器
  - [ ] 16.1 准备LSTM基础模型
    - 下载或训练LSTM基础模型
    - 转换为ONNX格式
    - 打包到resources/models/lstm_base.onnx
    - _需求：9.2_
  
  - [ ] 16.2 创建LSTMLearner类
    - 实现密码添加到历史
    - 实现文件名模式提取
    - 实现根据文件名生成密码
    - 实现模型微调触发逻辑
    - _需求：9.1, 9.2, 9.3, 9.4_
  
  - [ ] 16.3 编写Python训练脚本
    - 创建train_lstm.py
    - 实现LSTM微调逻辑
    - 支持命令行参数（模型路径、密码、epochs、lr）
    - _需求：9.2_
  
  - [ ]* 16.4 编写LSTM学习器测试
    - 测试密码历史记录
    - 测试模型微调触发
    - 测试命中率提升10%
    - **属性11：LSTM学习收敛性**
    - **验证需求：9.1, 9.2, 9.3, 9.4**

- [ ] 17. 集成LSTM到破解流程
  - [ ] 17.1 修改index.js集成LSTM
    - 破解成功后调用LSTMLearner.addPassword()
    - 在AI Phase中调用LSTM生成密码
    - _需求：9.1, 9.3_
  
  - [ ] 17.2 添加隐私设置UI
    - 添加"学习我的密码习惯"开关
    - 添加"清除历史数据"按钮
    - 修改FileCompressor.jsx
    - _需求：13.3_

- [ ] 18. LSTM阶段检查点
  - 测试本地学习功能
  - 测试重度用户命中率提升10%
  - 测试隐私保护
  - 如有问题，询问用户

#### 第三阶段：在线学习（1周）

- [ ] 19. 实现服务器端API
  - [ ] 19.1 创建密码收集API
    - 创建server/api/collect.py
    - 实现POST /api/collect端点
    - 验证和存储密码哈希
    - _需求：10.1_
  
  - [ ] 19.2 创建模型下载API
    - 创建server/api/download.py
    - 实现GET /api/models/latest端点
    - 返回最新模型版本和下载链接
    - _需求：10.3, 10.4_
  
  - [ ] 19.3 实现数据清洗脚本
    - 创建server/scripts/clean_data.py
    - 去重、过滤恶意数据
    - 验证密码有效性
    - _需求：10.6_
  
  - [ ] 19.4 实现模型训练脚本
    - 创建server/scripts/train_passgan.py
    - 每周自动重新训练PassGAN
    - 保存新模型版本
    - _需求：10.2_

- [ ] 20. 实现客户端在线学习功能
  - [ ] 20.1 创建ModelUpdater类
    - 实现检查最新模型版本
    - 实现下载新模型
    - 实现模型更新和替换
    - _需求：10.3, 10.4_
  
  - [ ] 20.2 实现密码上传功能
    - 破解成功后可选上传密码哈希
    - 完全匿名，不包含用户信息
    - _需求：10.1, 10.5_
  
  - [ ] 20.3 添加在线学习UI设置
    - 添加"贡献数据帮助改进"开关
    - 添加"自动更新模型"开关
    - 显示当前模型版本
    - 修改FileCompressor.jsx
    - _需求：10.1, 10.5, 13.3_
  
  - [ ]* 20.4 编写在线学习测试
    - 测试模型更新功能
    - 测试隐私保护（不上传时无网络请求）
    - **属性14：隐私保护完整性**
    - **属性18：模型更新向后兼容**
    - **验证需求：10.1, 10.3, 10.4, 10.5, 13.3**

- [ ] 21. 在线学习阶段检查点
  - 测试服务器API功能
  - 测试客户端上传和下载
  - 测试隐私保护
  - 如有问题，询问用户

#### 第四阶段：AI模型整合（2-3天）

- [ ] 22. 实现AI协调器
  - [ ] 22.1 创建AIOrchestrator类
    - 实现混合密码生成策略
    - PassGPT生成50% → LSTM排序30% → Markov填充20%
    - 实现模型权重配置
    - _需求：11.1, 11.2_
  
  - [ ] 22.2 实现性能优化
    - 实现模型缓存
    - 实现并行推理
    - 优化内存使用
    - _需求：11.6_
  
  - [ ]* 22.3 编写AI协调器测试
    - 测试混合策略正确性
    - 测试命中率达到55-60%（PassGPT优势）
    - **属性13：AI模型协同效果**
    - **验证需求：11.1, 11.2, 11.5, 11.6**

- [ ] 23. 最终集成和优化
  - [ ] 23.1 集成AIOrchestrator到破解流程
    - 替换单独的PassGPT调用
    - 使用AIOrchestrator生成密码
    - _需求：11.1_
  
  - [ ] 23.2 性能调优
    - 调整批量大小
    - 调整模型权重
    - 优化Phase顺序
    - **属性17：批量大小优化**
  
  - [ ] 23.3 添加性能监控和日志
    - 记录每个Phase耗时和命中率
    - 记录错误日志
    - 记录性能指标
    - _需求：14.1, 14.2, 14.3, 14.4, 14.5_

- [ ] 24. 阶段3最终检查点
  - 运行完整测试套件
  - 性能测试：验证速度达到5000 pwd/s
  - 命中率测试：验证达到55-60%（PassGPT优势）
  - 用户体验测试：验证所有UI功能
  - 如有问题，询问用户

---

## 注意事项

- 标记`*`的任务为可选测试任务，可以跳过以加快MVP开发
- 每个任务引用了具体的需求编号，便于追溯
- 属性测试验证了通用正确性属性
- 检查点任务确保增量验证，及时发现问题
- 建议按阶段发布：v1.0（阶段1）→ v2.0（阶段2）→ v3.0（阶段3）

---

## 开发环境要求

### Node.js依赖
- onnxruntime-node: ^1.16.0
- sqlite3: ^5.1.6
- node-fetch: ^3.3.0（用于服务器API调用）

### Python依赖（服务器端）
- torch: ^2.0.0
- onnx: ^1.14.0
- flask: ^2.3.0
- numpy: ^1.24.0

### 工具要求
- 7-Zip: 19.00+
- Python: 3.8+
- Node.js: 16+

---

## 预期成果

### 阶段1完成后
- ✅ 速度：1000 pwd/s（100倍提升）
- ✅ 常见密码破解时间减少60%
- ✅ 无效尝试减少75%

### 阶段2完成后
- ✅ 速度：2000 pwd/s（200倍提升）
- ✅ 支持断点续传
- ✅ 命中率提升25%
- ✅ 实时统计可视化

### 阶段3完成后
- ✅ 速度：5000 pwd/s（500倍提升）
- ✅ AI命中率55-60%（PassGPT Transformer架构优势）
- ✅ 支持本地学习
- ✅ 支持在线学习（可选）
- ✅ 行业领先水平
