# 密码破解快速阶段跳过问题修复规范

## 📋 问题概述

**问题描述**: 用户报告密码破解过程中，AI阶段之前的阶段（FastCombo、Top10K等）立即跳过，没有实际执行密码测试。

**症状**:
- 阶段立即结束，显示 `combined attempts: 0`
- 错误代码 `4294967295` 
- 没有测试任何密码就跳到下一阶段
- 用户看到阶段快速跳过而不是正常执行

## 🎯 用户故事

### 主要用户故事

**作为** 密码破解工具的用户  
**我希望** 每个破解阶段都能正常执行并测试密码  
**以便** 我能看到真实的破解进度和结果

### 具体需求

1. **错误诊断增强**
   - **作为** 用户，**我希望** 看到清晰的错误信息而不是神秘的错误代码
   - **以便** 我能理解问题所在并采取相应措施

2. **自动回退机制**
   - **作为** 用户，**我希望** 当GPU模式失败时系统自动切换到CPU模式
   - **以便** 破解任务能继续进行而不是完全失败

3. **启动前检查**
   - **作为** 用户，**我希望** 系统在启动破解前检查所有必要组件
   - **以便** 避免无意义的尝试和更快的错误发现

4. **详细进度反馈**
   - **作为** 用户，**我希望** 看到每个阶段的实际执行状态
   - **以便** 我能了解破解进度和当前状态

## ✅ 验收标准

### 功能性验收标准

1. **错误处理**
   - [ ] 异常退出代码（4294967295）被正确识别和报告
   - [ ] 提供具体的错误类型和解决建议
   - [ ] 不再显示神秘的错误代码给用户

2. **预检查机制**
   - [ ] 启动前检查hashcat可执行文件存在
   - [ ] 启动前检查hash文件存在
   - [ ] 启动前检查工作目录存在
   - [ ] 预检查失败时提供明确的错误信息

3. **自动回退**
   - [ ] GPU攻击失败时自动检测
   - [ ] 无缝切换到CPU模式
   - [ ] 用户收到回退通知
   - [ ] CPU模式正常工作

4. **进度反馈**
   - [ ] 显示实际的密码测试数量
   - [ ] 显示当前阶段的真实状态
   - [ ] 不再出现 `combined attempts: 0` 的情况

### 技术验收标准

1. **错误代码处理**
   - [ ] 检测 `code === 4294967295` 或其他异常代码
   - [ ] 提供详细的调试信息
   - [ ] 包含具体的错误建议

2. **进程错误处理**
   - [ ] 捕获 ENOENT（文件不存在）错误
   - [ ] 捕获 EACCES（权限拒绝）错误
   - [ ] 捕获 EPERM（操作不允许）错误
   - [ ] 为每种错误提供解决建议

3. **回退机制**
   - [ ] 检测GPU攻击崩溃
   - [ ] 标记会话需要CPU回退
   - [ ] 调用CPU破解函数
   - [ ] 保持会话状态连续性

## 🚫 非功能性需求

### 性能要求
- 预检查应在1秒内完成
- 错误检测不应显著影响正常执行性能
- 回退机制应在5秒内完成切换

### 可用性要求
- 错误信息应该用户友好，避免技术术语
- 提供可操作的解决建议
- 保持与现有UI的一致性

### 兼容性要求
- 支持Windows和Mac平台
- 兼容现有的密码破解流程
- 不影响正常工作的GPU模式

## 🔍 技术约束

### 平台约束
- Windows: 使用 hashcat.exe
- Mac: 使用 hashcat 二进制文件
- 需要处理不同平台的路径差异

### 依赖约束
- 依赖 hashcat 工具的可用性
- 需要 7z 工具用于CPU回退
- 依赖现有的会话管理系统

### 安全约束
- 不应暴露敏感的系统路径信息
- 错误日志不应包含密码或hash信息
- 保持现有的安全措施

## 📊 成功指标

### 主要指标
- **错误率降低**: 神秘错误代码报告减少100%
- **用户满意度**: 用户能理解错误信息并采取行动
- **成功率提升**: GPU失败时CPU回退成功率达到95%+

### 次要指标
- **响应时间**: 错误检测和报告在2秒内完成
- **日志质量**: 调试信息完整且有用
- **用户反馈**: 减少关于"阶段跳过"的用户报告

## 🎯 优先级

**P0 (关键)**: 
- 异常退出代码检测和报告
- GPU到CPU自动回退机制

**P1 (高)**: 
- 启动前预检查
- 详细的进程错误处理

**P2 (中)**: 
- 用户友好的错误信息
- 性能优化

## 📝 相关文档

- `FAST_PHASE_SKIP_DEBUG.md` - 问题分析文档
- `FAST_PHASE_SKIP_FIX_COMPLETE.md` - 修复完成报告
- `src/main/modules/fileCompressor/index.js` - 主要实现文件

## 🧪 测试场景

### 场景1: hashcat不存在
- **给定**: hashcat可执行文件不存在
- **当**: 用户启动密码破解
- **那么**: 显示"Hashcat executable not found"错误

### 场景2: GPU攻击崩溃
- **给定**: GPU模式启动但立即崩溃
- **当**: 检测到异常退出代码
- **那么**: 自动切换到CPU模式并通知用户

### 场景3: 权限问题
- **给定**: hashcat文件存在但无执行权限
- **当**: 尝试启动hashcat进程
- **那么**: 显示权限错误和解决建议

### 场景4: 正常执行
- **给定**: 所有组件正常
- **当**: 启动密码破解
- **那么**: 显示实际的密码测试进度